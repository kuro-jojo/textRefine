<main class="p-6 mx-auto container">
    <!-- Results Panel (Right) -->
    <div id="results-panel" class="w-full flex flex-col gap-6">
        <!-- Overall Score -->
        <div *ngIf="evaluationResult">
            <app-overall-score
                [score]="evaluationResult.score"
                [sophisticationLevel]="
                    evaluationResult.vocabulary.sophistication.level
                "
                [wordCount]="evaluationResult.vocabulary.precision.word_count"
                [uniqueCount]="
                    evaluationResult.vocabulary.lexical_diversity.unique_count
                "
            ></app-overall-score>
        </div>
        <div *ngIf="error" class="bg-red-50 text-red-600 p-4 rounded-lg mb-4">
            {{ error }}
        </div>

        <!-- Score Cards -->
        <div
            id="score-cards"
            class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4 mb-6"
        >
            <!-- Correctness -->
            <app-score-card
                title="Correctness"
                subtitle="Grammar & Spelling"
                [score]="evaluationResult?.correctness?.score ?? null"
                icon="check"
            ></app-score-card>

            <!-- Sophistication -->
            <app-score-card
                title="Sophistication"
                subtitle="Language Level"
                [score]="
                    evaluationResult?.vocabulary?.sophistication?.score ?? null
                "
                [level]="
                    evaluationResult?.vocabulary?.sophistication?.level ?? null
                "
                icon="graduation-cap"
            ></app-score-card>

            <!-- Precision -->
            <app-score-card
                title="Precision"
                subtitle="Clarity & Conciseness"
                [score]="evaluationResult?.vocabulary?.precision?.score ?? null"
                icon="bullseye"
            ></app-score-card>

            <!-- Vocabulary Diversity -->
            <app-score-card
                title="Lexical Diversity"
                subtitle="Word Diversity"
                [score]="
                    evaluationResult?.vocabulary?.lexical_diversity?.ttr ?? null
                "
                icon="book"
            ></app-score-card>

            <!-- Readability -->
            <app-score-card
                title="Readability"
                subtitle="Ease of Reading"
                [score]="
                    evaluationResult?.vocabulary?.lexical_diversity?.ttr ?? null
                "
                icon="book"
            ></app-score-card>
        </div>

        <!-- Detailed Breakdown Tabs -->
        <div
            *ngIf="tabs.length === 0"
            class="bg-white rounded-xl p-6 text-center text-gray-600 font-medium text-xl shadow-xl mb-6"
        >
            <p>No issues found</p>
        </div>
        <div
            id="detailed-breakdown"
            class="bg-white rounded-xl shadow-xl mb-6"
            *ngIf="tabs.length > 0"
        >
            <div class="border-b">
                <nav class="flex -mb-px">
                    <button
                        *ngFor="let tab of tabs"
                        (click)="selectTab(tab.id)"
                        class="py-4 px-6 font-medium {{
                            getSelectedTabColor(tab.id).text
                        }} hover:text-gray-700"
                        [class.hover:text-gray-700]="!isSelected(tab.id)"
                        [class.border-b-2]="isSelected(tab.id)"
                        [class.border-primary-600]="isSelected(tab.id)"
                    >
                        <i class="mr-2 fas fa-{{ tab.icon }}"></i
                        >{{ tab.title }}
                    </button>
                </nav>
            </div>
            <div id="breakdown-content" class="divide-y">
                <div
                    class="p-4 flex flex-col md:flex-row md:items-center md:justify-between gap-3 border-b bg-gray-50"
                    id="breakdown-controls"
                >
                    <div class="flex flex-wrap items-center gap-2">
                        <span class="text-xs font-semibold text-gray-700 mr-2"
                            >Filter:</span
                        >
                        <select
                            class="border border-gray-200 rounded px-2 py-1 text-xs focus:ring-primary-500"
                            [(ngModel)]="selectedSeverity"
                            (change)="updateFilteredIssues()"
                        >
                            <option value="">All Severities</option>
                            <option value="Minor">Minor</option>
                            <option value="Medium">Medium</option>
                            <option value="Major">Major</option>
                        </select>
                        <select
                            class="border border-gray-200 rounded px-2 py-1 text-xs focus:ring-primary-500"
                            [(ngModel)]="selectedType"
                            (change)="updateFilteredIssues()"
                        >
                            <option value="">All Types</option>
                            <option
                                *ngFor="let category of errorCategories"
                                value="{{ category }}"
                                [selected]="selectedType === category"
                            >
                                {{ category }}
                            </option>
                        </select>
                        <select
                            *ngIf="selectedTab === 'correctness'"
                            class="border border-gray-200 rounded px-2 py-1 text-xs focus:ring-primary-500"
                            [(ngModel)]="sortBy"
                            (change)="updateFilteredIssues()"
                        >
                            <option value="location">Location</option>
                            <option value="severity">Severity</option>
                            <option value="category">Category</option>
                        </select>
                        <button
                            class="border border-gray-200 rounded px-2 py-1 text-xs bg-red-500 text-white hover:bg-red-600 cursor-pointer"
                            (click)="resetFilters()"
                        >
                            Reset
                        </button>
                    </div>
                </div>
                <!-- Correctness Panel -->
                <div
                    id="breakdown-panel-correctness"
                    class="accordion-content p-6 show"
                    *ngIf="selectedTab === 'correctness'"
                >
                    <div class="mb-4">
                        <h3
                            class="text-lg font-semibold text-gray-800 mb-2 flex items-center"
                        >
                            <i class="text-blue-600 mr-2 fa fa-check"></i>
                            Grammar &amp; Spelling Issues
                        </h3>
                        <div
                            *ngIf="filteredIssues.length === 0"
                            class="text-gray-500 text-xl text-center my-4"
                        >
                            No issues found
                        </div>
                        <div
                            *ngIf="filteredIssues.length > 0"
                            class="grid md:grid-cols-2 gap-4"
                        >
                            <app-issue-detail
                                *ngFor="let issue of filteredIssues"
                                [issue]="issue"
                                [rawText]="rawText"
                                class="rounded-lg mb-2"
                            ></app-issue-detail>
                        </div>
                    </div>
                </div>
                <!-- Precision Panel -->
                <div
                    id="breakdown-panel-precision"
                    class="accordion-content p-0 show"
                    *ngIf="selectedTab === 'precision'"
                >
                    <!-- Summary Card -->
                    <div
                        id="precision-summary-card"
                        class="p-6 flex flex-col md:flex-row md:items-center md:justify-between gap-6"
                    >
                        <div class="flex items-center space-x-4 flex-1">
                            <div
                                class="rounded-lg {{
                                    getScoreColor(precisionResult?.score).bg
                                }} p-4 flex flex-col items-center justify-center w-32 h-32"
                            >
                                <span
                                    class="text-3xl font-bold {{
                                        getScoreColor(precisionResult?.score)
                                            .text
                                    }}"
                                    >{{
                                        getScoreInPercentage(
                                            precisionResult?.score
                                        )
                                    }}</span
                                >
                                <span
                                    class="text-xs font-medium {{
                                        getScoreColor(precisionResult?.score)
                                            .text
                                    }}  mt-1"
                                    >Precision Score</span
                                >
                            </div>
                            <div class="flex flex-col space-y-2 ml-2">
                                <div class="flex items-center space-x-2">
                                    <i
                                        class="fas fa-align-left text-blue-400"
                                    ></i>
                                    <span
                                        class="text-sm text-gray-700 font-medium"
                                        >Word Count:</span
                                    >
                                    <span class="text-gray-900 font-bold">{{
                                        precisionResult?.word_count
                                    }}</span>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <i class="fas fa-bolt text-yellow-400"></i>
                                    <span
                                        class="text-sm text-gray-700 font-medium"
                                        >Total Issues:</span
                                    >
                                    <span class="text-gray-900 font-bold">{{
                                        precisionResult?.issues?.length
                                    }}</span>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <i class="fas fa-percent text-red-400"></i>
                                    <span
                                        class="text-sm text-gray-700 font-medium"
                                        >Penalty:</span
                                    >
                                    <span class="text-gray-900 font-bold">{{
                                        getScoreInPercentage(
                                            precisionResult?.normalized_penalty
                                        )
                                    }}</span>
                                    <span
                                        class="ml-1 relative group cursor-pointer"
                                    >
                                        <i
                                            class="fa-regular fa-circle-question text-blue-400"
                                        ></i>
                                        <span
                                            class="absolute left-1/2 -translate-x-1/2 top-full mt-1 w-48 bg-white border border-gray-200 rounded shadow-lg text-xs text-gray-700 px-2 py-1 opacity-0 group-hover:opacity-100 pointer-events-none z-10 transition"
                                        >
                                            Penalty = (Total penalty / Word
                                            Count), normalized for text length.
                                        </span>
                                    </span>
                                </div>
                            </div>
                        </div>
                        <div
                            class="w-full md:w-48 flex flex-col items-center justify-center"
                        >
                            <app-issue-distribution-chart
                                [issues]="precisionResult?.issues || []"
                                class="w-full md:w-48"
                            ></app-issue-distribution-chart>
                        </div>
                    </div>
                    <!-- Issues: Word Usage & Stylistic -->
                    <div
                        class="flex flex-col md:flex-row gap-8 mt-6 px-6 pb-6"
                        id="precision-issue-sections"
                    >
                        <!-- Word Usage Issues -->
                        <div id="word-usage-issues" class="flex-1">
                            <div class="flex items-center mb-3 space-x-2">
                                <i class="fas fa-bullseye text-yellow-500"></i>
                                <h4
                                    class="text-base font-semibold text-gray-800"
                                >
                                    Word Usage Issues
                                </h4>
                            </div>
                            <div class="flex flex-col gap-4">
                                <app-issue-detail
                                    *ngFor="
                                        let issue of getIssuesByCategory(
                                            Category.WordUsage
                                        )
                                    "
                                    [issue]="issue"
                                    [rawText]="rawText"
                                    class="mb-2"
                                ></app-issue-detail>
                            </div>
                        </div>
                        <!-- Stylistic Issues -->
                        <div id="stylistic-issues" class="flex-1">
                            <div class="flex items-center mb-3 space-x-2">
                                <i
                                    class="fas fa-paintbrush text-fuchsia-500"
                                ></i>
                                <h4
                                    class="text-base font-semibold text-gray-800"
                                >
                                    Stylistic Issues
                                </h4>
                            </div>
                            <div class="flex flex-col gap-4">
                                <app-issue-detail
                                    *ngFor="
                                        let issue of getIssuesByCategory(
                                            Category.Stylistic
                                        )
                                    "
                                    [issue]="issue"
                                    [rawText]="rawText"
                                    class="mb-2"
                                ></app-issue-detail>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Text Highlights View -->
        <div id="text-highlights" class="bg-white rounded-lg shadow-sm p-6">
            <h3 class="text-lg font-semibold text-gray-800 mb-4">
                Text with Highlights
            </h3>
            <div
                class="p-4 bg-gray-50 rounded-lg border border-gray-200 prose max-w-none"
            >
                <p>
                    The principles of human-centered design have proven to be
                    effective and productive. However, its approach is generally
                    used in situations where professionals determine the needs
                    of the target populations and then develop products and
                    procedures to address
                    <span
                        class="bg-yellow-100 cursor-help border-b border-dashed border-yellow-400"
                        title="Vague reference - Consider specifying which needs are being addressed"
                        >the needs</span
                    >. This is Top-Down design: starting with higher-level
                    conceptualizations and then refining the ideas and concepts
                    to specific instances of products or services. This works
                    well for
                    <span
                        class="bg-red-100 cursor-help border-b border-dashed border-red-400"
                        title="Missing hyphen in compound adjective - Should be 'mass-produced'"
                        >mass produced</span
                    >
                    items which only allows limited specialization for
                    individual needs and requirements.
                </p>
                <p>
                    The research was comprehensive
                    <span
                        class="bg-red-100 cursor-help border-b border-dashed border-red-400"
                        title="Missing comma in compound sentence - Add a comma before 'but'"
                        >but</span
                    >
                    the conclusions were limited. The team of researchers
                    <span
                        class="bg-yellow-100 cursor-help border-b border-dashed border-yellow-400"
                        title="Subject-verb agreement error - 'Team' is singular and should take 'was'"
                        >were</span
                    >
                    analyzing the data. The study had a significant
                    <span
                        class="bg-red-100 cursor-help border-b border-dashed border-red-400"
                        title="Incorrect word usage - Use 'effect' (noun) instead of 'affect' (verb)"
                        >affect</span
                    >
                    on subsequent research.
                </p>
                <p>
                    The
                    <span
                        class="bg-blue-100 cursor-help border-b border-dashed border-blue-400"
                        title="Advanced vocabulary - Consider if this term is appropriate for your audience"
                        >methodology</span
                    >
                    employed in this study represents a
                    <span
                        class="bg-blue-100 cursor-help border-b border-dashed border-blue-400"
                        title="Advanced vocabulary - A more common alternative could be 'significant'"
                        >substantial</span
                    >
                    departure from conventional approaches to the subject
                    matter.
                </p>
            </div>
            <div class="mt-4 flex flex-wrap gap-4">
                <div class="flex items-center">
                    <span class="w-3 h-3 bg-red-100 rounded mr-2"></span>
                    <span class="text-sm text-gray-600"
                        >Grammar &amp; Spelling</span
                    >
                </div>
                <div class="flex items-center">
                    <span class="w-3 h-3 bg-yellow-100 rounded mr-2"></span>
                    <span class="text-sm text-gray-600"
                        >Clarity &amp; Precision</span
                    >
                </div>
                <div class="flex items-center">
                    <span class="w-3 h-3 bg-blue-100 rounded mr-2"></span>
                    <span class="text-sm text-gray-600"
                        >Advanced Vocabulary</span
                    >
                </div>
                <div class="flex items-center">
                    <span class="w-3 h-3 bg-green-100 rounded mr-2"></span>
                    <span class="text-sm text-gray-600">Well-constructed</span>
                </div>
            </div>
        </div>
    </div>
</main>
